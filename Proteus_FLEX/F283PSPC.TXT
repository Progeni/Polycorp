*  F283PSPC
*
* DOS PRINTER SPOOLER
*
 ORG $C700

CMDEND EQU *
PSPOOL JMP LC723
 JMP LC75C
 JMP LC75D

LC709 JMP LC74C

LC70C JMP LC757
 JMP LC71F

LC712 FCB $0C,$00,$00,$00,$00,$C8,$10

LC719 FCB $C8,$10

LC71B FCB $00

LC71C FCB $00

LC71D FCB $00

LC71E FCB $00

LC71F JMP [IHNDLR]

LC723 ORCC #$50 DISABLE FIRQ AND IRQ
 LDX LCC31
 STS 2,X
 TST LCC34
 BNE LC741
 LDX #PRCFLG ACTIVE SPOOLING PROCESS FLAG
 INC LCC34
 TST 0,X
 BEQ LC741

LC73A STX LCC31
 LDS 2,X
 RTI

LC741 LDX #SCR_D
 CLR LCC34
 BRA LC73A

LC749 SWI3
 NOP

LC74C ORCC #$50 DISABLE FIRQ AND IRQ
 TST FMSBSY
 BNE LC749
 INC FMSBSY
 RTS

LC757 CLR FMSBSY
 ANDCC #$AF ENABLE FIRQ AND IRQ

LC75C RTS

LC75D ORCC #$50 DISABLE FIRQ AND IRQ
 TST LC71B
 BEQ LC78D
 LDX LC719
 LDA 0,X
 PSHS A
 LDD 1,X
 LDX #SYFCB2
 STD SECBUF,X
 PULS A
 STA DRVENO,X
 CLR FNCODE,X
 LDA #1
 STA ACSTAT,X
 CLR DATIND,X
 CLR SPCOMP,X

LC783 TST LC71E
 BEQ LC79B
 SWI3
 NOP
 BRA LC783

LC78D JSR [TMOFFA]
 ANDCC #$AF ENABLE FIRQ AND IRQ
 CLR PRCFLG ACTIVE SPOOLING PROCESS FLAG
 SWI3
 NOP
 BRA LC78D

LC79B TST LC71D
 BNE LC7C7
 LDX #SYFCB2
 JSR FMS FILE MANAGER EXEC CALL
 BNE LC7C7
 TST LC71C
 BEQ LC7BC
 CLR LC71C
 CMPA #$0A
 BEQ LC7C3
 PSHS A
 LDA #$0A
 BSR LC7F9
 PULS A

LC7BC CMPA #$0D
 BNE LC7C3
 STA LC71C

LC7C3 BSR LC7F9
 BRA LC79B

LC7C7 LDA #$0D
 BSR LC7F9
 LDA #$0A
 BSR LC7F9
 LDA LC712
 BSR LC7F9
 CLR LC71D
 LDX LC719
 TST 3,X
 BEQ LC7E3
 DEC 3,X
 JMP LC75D

LC7E3 LEAX 4,X
 CMPX #SYSFCB SYSTEM FCB ADDRESS
 BNE LC7ED
 LDX #FLEXTL

LC7ED STX LC719
 DEC LC71B
 JMP LC75D

LC7F6 SWI3
 NOP

LC7F9 JSR PCHK
 BPL LC7F6
 JMP POUT

